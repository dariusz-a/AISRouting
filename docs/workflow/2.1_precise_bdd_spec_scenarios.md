# Precise BDD Spec Scenarios Refinement Guide

You are a senior Automation QA (Quality Assurance) Engineer.  

Use this guide to refine the BDD scenarios for <FEATURE> in `docs/spec_scenarios/[<FEATURE>]_spec.md`. The outcome must be precise, testable, and exhaustive enough for developers and testers to implement and validate without further clarification.

---

## Role: Automation QA (Quality Assurance) Engineer
When executing this prompt, you MUST assume the role of an Automation QA (Quality Assurance) Engineer with expertise in preparing test scenarios using the Gherkin scenario format. 

## Input Sources

Read the below documents in full.
- Previously generated BDD files in `docs/spec_scenarios/[<FEATURE>]_spec.md`
- Related user manual in `docs/user_manual/[<FEATURE>].md`
---

## Objective
Produce comprehensive, circumstantial BDD scenarios that:
- Remove ambiguity in user actions and system responses
- Capture role/permissions and qualifications required to perform actions
- Specify UI context, data prerequisites, and exact outcomes per step
- Include both happy paths and negative/edge cases with explicit error feedback

## Where to Write
- Overwrite and refine the scenarios in `docs/spec_scenarios/[<FEATURE>]_spec.md`.
- Maintain one file per user manual section; keep the original Feature title but improve content beneath it.

## Mandatory Elements for Every Scenario
For each Gherkin scenario provide the refined Gherkin. Use the template below.

### Data Source Requirements
- Use only entities and values defined in `docs/workflow/inputs/mock_data.md` for all people, users, teams, projects, roles, skills, IDs, and security groups.
- Do not invent new names, emails, IDs, or labels. If a value is missing, choose another from the mock data file or parametrize via Scenario Outline using values present in that file.
- Keep naming consistent with the mock data (e.g., person IDs like `person-alice`, team IDs like `team-1`, role IDs like `role-2`).

### Gherkin Scenario Rules
- Use clear, unambiguous Given/When/Then steps.
- Exactly one Given, one When, and one Then per scenario. If more are needed, split the flow into multiple scenarios.
- Default chaining style (required): extend a single Given/When/Then by chaining sub-steps inline using lowercase "and" within the same line. End the line with a period.
- Alternative readability style (allowed): use separate lines starting with capitalized "And" for additional steps. Do not mix inline "and" and newline "And" within the same scenario.
- Do not introduce additional Given/When/Then keywords within the same scenario; only extend using inline "and" (default) or separate "And" lines (allowed alternative).
- After the action, include an immediate, visible system response in the Then step.
- For async actions, specify wait conditions (e.g., "Then a loading indicator with data-testid=... is shown until ...").
- Capture exact messages, colors, icons, and state changes when documented (e.g., error banner text; badge color logic; disabled states).
- Include negative cases for validation errors, authorization failures, and edge conditions.

## Scenario Template
Replicate this structure for each scenario. Replace bracketed text with concrete values.

Gherkin:
# Feature: [Keep original feature title]

### Scenario: [Concise, outcome-oriented title]
  Given [explicit initial state]
  And [any additional state]
  When [user performs a single concrete action]
  And [optional additional action]
  Then [immediate, visible, verifiable outcome]
  And [persisted state or navigation if applicable]

### Examples: (use only for Scenario Outline)
  | [column] | [value] |

## Coverage Requirements
- Include happy path and at least 2 negative/edge scenarios per feature:
  - Validation errors (missing/invalid input)
  - Authorization/permissions failures (insufficient role/qualifications)
  - Empty/zero state behavior, where relevant
  - Conflict/race conditions if applicable (e.g., duplicate names)

## Best Practices
- Be specific: name the control, location, and expected UI changes.
- Reference the exact message copy and formatting when defined in manuals.
- Use data-testids or unique labels when available; otherwise, provide unambiguous selectors/descriptions.
- Persistency: explicitly state whether changes survive reload/navigation and how this is verified.
- Sorting/Filtering: state ordering rules and verify post-action placement.
- Accessibility: note important ARIA roles/labels or focus management when specified.

### Style examples for chaining sub-steps

Inline chaining style (default/required):
```gherkin
When the user opens the dialog and selects "Save" and confirms the action.
Then a success banner with text "Saved" is visible and the dialog closes.
```

Alternative newline style (allowed):
```gherkin
When the user opens the dialog
And selects "Save"
And confirms the action
Then a success banner with text "Saved" is visible
And the dialog closes
```

## Example Improvement
Original (vague):
> When the user clicks the pin icon, the vessel is moved to the top of the list.

# Feature: Manage Fleet Overview

## Positive Scenarios

### Scenario: Pin a vessel to the top of the overview list
  Given the fleet supervisor is on the Fleet Overview page with the list showing "Aurora" 
  And the pin icon enabled for "Aurora"
  When the supervisor clicks the pin icon for "Aurora"
  Then "Aurora" moves to the top of the list immediately
  And the pin icon changes to the highlighted state
  And after refreshing the page, "Aurora" remains pinned at the top

### Scenario: Highlight the pin icon after pinning
  Given the vessel "Aurora" is visible 
  And currently unpinned on the Fleet Overview page
  When the supervisor pins "Aurora"
  Then the pin icon for "Aurora" is shown in the highlighted state

### Scenario: Pinned vessel persists after page refresh
  Given the vessel "Aurora" is pinned at the top of the list on the Fleet Overview page
  When the supervisor refreshes the page
  Then "Aurora" remains pinned at the top of the list

### Scenario: Pin action unavailable without permission
  Given a regular user without can_pin_vessels is on the Fleet Overview page with the list showing "Aurora"
  When the user views the pin icon for "Aurora"
  Then the pin icon is disabled

## Negative Scenarios

### Scenario: Tooltip shown for disabled pin icon
  Given a regular user without can_pin_vessels is on the Fleet Overview page with the list showing "Aurora"
  When the user hovers the disabled pin icon for "Aurora"
  Then a tooltip with text "Insufficient permissions" is visible

## Output Rules
- Overwrite existing scenarios in `docs/spec_scenarios/[<FEATURE>]_spec.md` with refined versions.
- Preserve the Feature title; ensure each scenario is written in Gherkin.
- Use consistent formatting and realistic example data across the file.
- Cross-reference related features when workflows span entities (e.g., creating a person before assigning to a team).

## Quality Checklist (apply to every scenario)
- Role and Qualifications are explicitly stated and align with permissions.
- Preconditions and Data Setup are concrete and reproducible.
- UI Context identifies exact controls and states; selectors or labels are unambiguous.
- Each action step has an immediate, testable outcome.
- Error states include the exact message text and disabled/validation behavior.
- Persisted state and navigation are verified when relevant.
- Negative/edge cases are present and meaningful.
- Language is precise; no vague verbs like "clicks something" or "sees stuff".

