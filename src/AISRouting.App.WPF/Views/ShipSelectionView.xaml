<UserControl x:Class="AISRouting.App.WPF.Views.ShipSelectionView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:converters="clr-namespace:AISRouting.App.WPF.Converters">
    
    <UserControl.Resources>
        <converters:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter"/>
        <Style x:Key="T0DatePickerStyle" TargetType="DatePicker">
            <Setter Property="BorderBrush" Value="Gray"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Style.Triggers>
                <DataTrigger Binding="{Binding IsT0Valid}" Value="False">
                    <Setter Property="BorderBrush" Value="Red"/>
                    <Setter Property="Background" Value="#FFFFEAEA"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>

        <Style x:Key="T0TextBoxStyle" TargetType="TextBox">
            <Setter Property="BorderBrush" Value="Gray"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Style.Triggers>
                <DataTrigger Binding="{Binding IsT0Valid}" Value="False">
                    <Setter Property="BorderBrush" Value="Red"/>
                    <Setter Property="Background" Value="#FFFFEAEA"/>
                </DataTrigger>
            </Style.Triggers>
        </Style>
    </UserControl.Resources>

    <StackPanel Margin="10">
        
        <!-- Input Folder Selection -->
        <GroupBox Header="Input Folder" Margin="0,0,0,10">
            <Grid Margin="10">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <TextBox Grid.Column="0" 
                         Text="{Binding InputFolderPath, Mode=OneWay}"
                         IsReadOnly="True"
                         VerticalAlignment="Center"
                         Margin="0,0,10,0"/>
                
                <Button Grid.Column="1"
                        Content="Browse..."
                        Command="{Binding SelectInputFolderCommand}"
                        Width="100"
                        AutomationProperties.AutomationId="browse-button"
                        AutomationProperties.Name="Browse for Input Folder"/>
            </Grid>
        </GroupBox>

        <!-- Error Message -->
        <TextBlock Text="{Binding ErrorMessage}"
                   Foreground="Red"
                   FontWeight="Bold"
                   Margin="0,0,0,10"
                   Visibility="{Binding ErrorMessage, Converter={StaticResource BoolToVisibilityConverter}}"
                   AutomationProperties.AutomationId="input-error"
                   AutomationProperties.Name="Input Root Error"/>

        <!-- Vessel Selection -->
        <GroupBox Header="Vessel Selection" Margin="0,0,0,10">
            <Grid Margin="10">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>

                <!-- Filter Section -->
                <Grid Grid.Row="0" Margin="0,0,0,10">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="Auto"/>
                    </Grid.RowDefinitions>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <!-- Name filter -->
                    <TextBlock Grid.Row="0" Grid.Column="0"
                               Text="Name filter (regex):"
                               VerticalAlignment="Center"
                               Margin="0,0,10,0"/>
                    <TextBox Grid.Row="0" Grid.Column="1" Grid.ColumnSpan="4"
                             Text="{Binding NameFilter, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                             VerticalAlignment="Center"
                             AutomationProperties.AutomationId="name-filter"
                             AutomationProperties.Name="Name Filter"/>

                    <!-- Length range -->
                    <TextBlock Grid.Row="1" Grid.Column="0"
                               Text="Length (m):"
                               VerticalAlignment="Center"
                               Margin="0,6,10,0"/>
                    <StackPanel Grid.Row="1" Grid.Column="1" Orientation="Horizontal" Margin="0,6,0,0">
                        <TextBox Text="{Binding LengthMinString, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                 Width="60"
                                 VerticalAlignment="Center"
                                 Margin="0,0,5,0"
                                 AutomationProperties.AutomationId="length-min-text"
                                 AutomationProperties.Name="Length Min"/>
                        <Slider Minimum="0"
                                Maximum="{Binding MaxLengthLimit}"
                                Value="{Binding LengthMin, Mode=TwoWay}"
                                Width="150"
                                VerticalAlignment="Center"
                                Margin="5,0"
                                TickFrequency="10"
                                IsSnapToTickEnabled="False"
                                AutomationProperties.AutomationId="length-min-slider"
                                AutomationProperties.Name="Length Min Slider"/>
                        <Slider Minimum="0"
                                Maximum="{Binding MaxLengthLimit}"
                                Value="{Binding LengthMax, Mode=TwoWay}"
                                Width="150"
                                VerticalAlignment="Center"
                                Margin="5,0"
                                TickFrequency="10"
                                IsSnapToTickEnabled="False"
                                AutomationProperties.AutomationId="length-max-slider"
                                AutomationProperties.Name="Length Max Slider"/>
                        <TextBox Text="{Binding LengthMaxString, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                 Width="60"
                                 VerticalAlignment="Center"
                                 Margin="5,0,0,0"
                                 AutomationProperties.AutomationId="length-max-text"
                                 AutomationProperties.Name="Length Max"/>
                    </StackPanel>

                    <!-- Width (beam) range -->
                    <TextBlock Grid.Row="2" Grid.Column="0"
                               Text="Width (m):"
                               VerticalAlignment="Center"
                               Margin="0,6,10,0"/>
                    <StackPanel Grid.Row="2" Grid.Column="1" Orientation="Horizontal" Margin="0,6,0,0">
                        <TextBox Text="{Binding BeamMinString, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                 Width="60"
                                 VerticalAlignment="Center"
                                 Margin="0,0,5,0"
                                 AutomationProperties.AutomationId="beam-min-text"
                                 AutomationProperties.Name="Beam Min"/>
                        <Slider Minimum="0"
                                Maximum="{Binding MaxBeamLimit}"
                                Value="{Binding BeamMin, Mode=TwoWay}"
                                Width="150"
                                VerticalAlignment="Center"
                                Margin="5,0"
                                TickFrequency="5"
                                IsSnapToTickEnabled="False"
                                AutomationProperties.AutomationId="beam-min-slider"
                                AutomationProperties.Name="Beam Min Slider"/>
                        <Slider Minimum="0"
                                Maximum="{Binding MaxBeamLimit}"
                                Value="{Binding BeamMax, Mode=TwoWay}"
                                Width="150"
                                VerticalAlignment="Center"
                                Margin="5,0"
                                TickFrequency="5"
                                IsSnapToTickEnabled="False"
                                AutomationProperties.AutomationId="beam-max-slider"
                                AutomationProperties.Name="Beam Max Slider"/>
                        <TextBox Text="{Binding BeamMaxString, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                 Width="60"
                                 VerticalAlignment="Center"
                                 Margin="5,0,0,0"
                                 AutomationProperties.AutomationId="beam-max-text"
                                 AutomationProperties.Name="Beam Max"/>
                    </StackPanel>

                </Grid>

                <!-- Vessel ComboBox -->
                <Grid Grid.Row="1" Margin="0,0,0,10">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <TextBlock Grid.Column="0" 
                               Text="Select Vessel:" 
                               VerticalAlignment="Center" 
                               Margin="0,0,10,0"/>
                    
                    <ComboBox Grid.Column="1"
                              ItemsSource="{Binding FilteredVessels}"
                              SelectedItem="{Binding SelectedVessel}"
                              DisplayMemberPath="DisplayName"
                              IsEnabled="{Binding IsInputRootValid}"
                              AutomationProperties.AutomationId="ship-combo"
                              AutomationProperties.Name="Select Vessel"/>
                </Grid>

                <!-- Static Data Display -->
                <GroupBox Grid.Row="2" Header="Ship Static Data">
                    <TextBox Text="{Binding StaticDataDisplay, Mode=OneWay}"
                             IsReadOnly="True"
                             TextWrapping="Wrap"
                             VerticalScrollBarVisibility="Auto"
                             Height="120"
                             FontFamily="Consolas"
                             AutomationProperties.AutomationId="ship-static"
                             AutomationProperties.Name="Ship Static Data"/>
                </GroupBox>
            </Grid>
        </GroupBox>

        <!-- Time Interval Selection -->
        <GroupBox Header="Time Interval Selection" Margin="0,0,0,10">
            <Grid Margin="10">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="150"/>
                </Grid.ColumnDefinitions>

                <!-- T0 Date picker and display -->
                <TextBlock Grid.Row="0" Grid.Column="0"
                           Text="T0 (base date):"
                           VerticalAlignment="Center"
                           Margin="0,0,10,0"/>
                <DatePicker Grid.Row="0" Grid.Column="1"
                            SelectedDate="{Binding T0Date, Mode=TwoWay}"
                            Margin="0,0,10,0"
                            Height="28"
                            VerticalAlignment="Center"
                            Style="{StaticResource T0DatePickerStyle}"
                            AutomationProperties.AutomationId="t0-picker"
                            AutomationProperties.Name="T0 Date"/>
                <TextBox Grid.Row="0" Grid.Column="3"
                         Text="{Binding T0DateString, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                         IsReadOnly="False"
                         VerticalAlignment="Center"
                         Height="28"
                         Style="{StaticResource T0TextBoxStyle}"
                         AutomationProperties.AutomationId="t0-textbox"
                         AutomationProperties.Name="T0 Date Text"/>
                <!-- T0 validation shown via control styling -->

                <!-- Start Time -->
                <TextBlock Grid.Row="1" Grid.Column="0" 
                           Text="Start Time:" 
                           VerticalAlignment="Center" 
                           Margin="0,6,10,0"/>
                <DatePicker Grid.Row="1" Grid.Column="1" 
                            SelectedDate="{Binding StartDate, Mode=TwoWay}"
                            Margin="0,6,10,0"
                            Height="28"
                            VerticalAlignment="Center"
                            AutomationProperties.AutomationId="start-picker"
                            AutomationProperties.Name="Start Date"/>
                <TextBlock Grid.Row="1" Grid.Column="2" 
                           Text="Time:" 
                           VerticalAlignment="Center" 
                           Margin="0,6,10,0"/>
                <TextBox Grid.Row="1" Grid.Column="3"
                         Text="{Binding StartTimeString, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                         Height="28"
                         VerticalAlignment="Center"
                         Margin="0,6,0,0"
                         AutomationProperties.AutomationId="start-time-picker"
                         AutomationProperties.Name="Start Time"/>

                <!-- Stop Time -->
                <TextBlock Grid.Row="2" Grid.Column="0" 
                           Text="Stop Time:" 
                           VerticalAlignment="Center" 
                           Margin="0,6,10,0"/>
                <DatePicker Grid.Row="2" Grid.Column="1" 
                            SelectedDate="{Binding StopDate, Mode=TwoWay}"
                            Margin="0,6,10,0"
                            Height="28"
                            VerticalAlignment="Center"
                            AutomationProperties.AutomationId="stop-picker"
                            AutomationProperties.Name="Stop Date"/>
                <TextBlock Grid.Row="2" Grid.Column="2" 
                           Text="Time:" 
                           VerticalAlignment="Center" 
                           Margin="0,6,10,0"/>
                <TextBox Grid.Row="2" Grid.Column="3"
                         Text="{Binding StopTimeString, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                         Margin="0,6,0,0"
                         Height="28"
                         VerticalAlignment="Center"
                         AutomationProperties.AutomationId="stop-time-picker"
                         AutomationProperties.Name="Stop Time"/>

                <!-- Validation Message removed; T0 invalid disables Create Track and shows red field -->

                <!-- Create Track Button -->
                <Button Grid.Row="3" Grid.Column="3"
                        Content="Create Track"
                        HorizontalAlignment="Right"
                        Width="150"
                        Height="35"
                    Margin="0,6,0,0"
                        Command="{Binding DataContext.CreateTrackCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                        ToolTip="{Binding DataContext.CreateTrackTooltip, RelativeSource={RelativeSource AncestorType=Window}}"
                        AutomationProperties.AutomationId="create-track-button"
                        AutomationProperties.Name="Create Track"/>
            </Grid>
        </GroupBox>

    </StackPanel>
</UserControl>
